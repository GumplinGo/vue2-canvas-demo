(function(){"use strict";var t={9532:function(t,r,e){var i=e(9994),a=function(){var t=this,r=t._self._c;return r("div",{staticClass:"dt-container"},[r("div",{ref:"canvasRef",staticClass:"canvas-wrap"},[r("canvas",{ref:"canvas",class:["canvas-el",{"is-drawing":t.isDrawing,"is-draging":t.isDraging}],attrs:{width:t.width,height:t.height},on:{click:t.handleClick,dblclick:t.handleDblclick,mousemove:t.handleMove,mousedown:t.handleDown,mouseup:t.handleUp}}),-1!==t.activeArrowIndex?r("div",{staticClass:"dialog",style:{left:t.mousePosition.x+"px",top:t.mousePosition.y+"px"}},[t.activeArrow.config?t._l(t.activeArrow.config,(function(e,i){return r("div",{key:i,staticClass:"dialog-item"},[t._v(" "+t._s(i)+": "),r("el-input",{attrs:{placeholder:""},model:{value:t.activeArrow.config[i],callback:function(r){t.$set(t.activeArrow.config,i,r)},expression:"activeArrow.config[key]"}})],1)})):t._e()],2):t._e()]),r("div",{staticClass:"btn"},[r("el-button",{attrs:{type:"primary"},on:{click:t.handleDrawArrow}},[t._v("绘制箭头")]),r("el-button",{attrs:{type:"primary"},on:{click:t.handleDrawArea}},[t._v("绘制区域")]),r("el-button",{attrs:{type:"primary"},on:{click:t.handleReverseArrow}},[t._v("翻转箭头")]),r("el-button",{attrs:{type:"primary"},on:{click:t.handleDeleteArrow}},[t._v("删除箭头")]),r("el-button",{attrs:{type:"primary"},on:{click:t.handleDeleteArea}},[t._v("删除区域")]),r("el-button",{attrs:{type:"primary"},on:{click:t.handleCheckArea}},[t._v("区域是否交叉")]),r("el-button",{attrs:{type:"primary"},on:{click:t.handleClear}},[t._v("清空配置")])],1)])},s=[];e(4381);function n(t,r,e,i,a,s,n){if(0===a)return!1;const o=a;let h=0,c=t;if(n>r+o&&n>i+o||n<r-o&&n<i-o||s>t+o&&s>e+o||s<t-o&&s<e-o)return!1;if(t===e)return Math.abs(s-t)<=o/2;h=(r-i)/(t-e),c=(t*i-e*r)/(t-e);const l=h*s-n+c,w=l*l/(h*h+1);return w<=o/2*o/2}function o(t,r,e,i,a){return(i-t)*(i-t)+(a-r)*(a-r)<e*e}function h(t){const r=[],e=[],i=[];for(let a=1;a<t.length;a++){const e=[];e.push(t[a-1],t[a]),r.push(e)}for(let a=0;a<r.length;a++)for(let t=0;t<r.length;t++)a!==t&&e.push([r[a],r[t]]);for(let a=0;a<e.length;a++){const t=c(e[a][0][0],e[a][0][1],e[a][1][0],e[a][1][1]);i.push(t)}return-1===i.findIndex((t=>!0===t))}function c(t,r,e,i){const a=(t.x-e.x)*(r.y-e.y)-(t.y-e.y)*(r.x-e.x),s=(t.x-i.x)*(r.y-i.y)-(t.y-i.y)*(r.x-i.x);if(a*s>=0)return!1;const n=(e.x-t.x)*(i.y-t.y)-(e.y-t.y)*(i.x-t.x),o=n+a-s;return!(n*o>=0)}class l{constructor(t,{arrowArr:r=[],areaArr:e=[]}){this.canvasEl=t,this.context=this.canvasEl.getContext("2d"),this.strokeStyle="#FF5A59",this.lineActiveStyle="#0037ff",this.fillStyle="rgba(255, 90, 89, 0.3)",this.areaActiveStyle="rgba(0, 55, 255, 0.5)",this.lineWidth=2,this.lineWidthRound=10,this.areaVertexRadius=10,this.arrowArr=r,this.areaArr=e,this.drawExistedArrow(),this.drawExistedArea(),this.dragOriginPoint={x:0,y:0},this.tempCopyArea=[],this.targetVertex=null,this.currentArrow=[],this.currentArea=[],this.activeArrowIndex=-1}setActiveArrowIndex(t){if(this.arrowArr.length){let r=!1;this.arrowArr.forEach(((e,i)=>{n(e.start.x,e.start.y,e.end.x,e.end.y,this.lineWidth+this.lineWidthRound,t.x,t.y)&&(this.activeArrowIndex=i,this.activeAreaIndex=-1,r=!0)})),r||(this.activeArrowIndex=-1)}}setActiveAreaIndex(t){if(this.areaArr.length){let r=!1;this.areaArr.forEach(((e,i)=>{e=e.area;const a=e[0];this.context.beginPath(),this.context.moveTo(a.x,a.y),e.slice(1).forEach((t=>{this.context.lineTo(t.x,t.y)})),this.context.lineTo(a.x,a.y),this.context.closePath(),this.context.isPointInPath(t.x,t.y)?(r=!0,this.activeAreaIndex=i,this.activeArrowIndex=-1):e.forEach((e=>{o(e.x,e.y,this.areaVertexRadius,t.x,t.y)&&(r=!0,this.activeAreaIndex=i,this.activeArrowIndex=-1)}))})),r||(this.activeAreaIndex=-1)}}reset(){this.clearCanvas(),this.arrowArr=[],this.areaArr=[],this.currentArea=[],this.currentArrow=[],this.activeArrowIndex=-1,this.activeAreaIndex=-1}reverseActiveArrow(){if(-1!==this.activeArrowIndex){const t=this.arrowArr[this.activeArrowIndex],r={start:t.end,end:t.start,config:t.config};this.arrowArr.splice(this.activeArrowIndex,1,r),this.clearCanvas(),this.drawExistedArrow()}}deleteActiveArrow(){-1!==this.activeArrowIndex&&(this.arrowArr.splice(this.activeArrowIndex,1),this.activeArrowIndex=-1,this.clearCanvas(),this.drawExistedArrow(),this.drawExistedArea())}deleteActiveArea(){-1!==this.activeAreaIndex&&(this.areaArr.splice(this.activeAreaIndex,1),this.activeAreaIndex=-1,this.clearCanvas(),this.drawExistedArrow(),this.drawExistedArea())}clearCanvas(){this.context.clearRect(0,0,this.canvasEl.width,this.canvasEl.height)}drawExistedArrow(t){this.arrowArr.length&&this.arrowArr.forEach(((r,e)=>{this.drawVerticalArrow(r.start,r.end);let i=!1;t&&(i=n(r.start.x,r.start.y,r.end.x,r.end.y,this.lineWidth+this.lineWidthRound,t.x,t.y));const a=this.activeArrowIndex===e;this.drawArrow(r.start,r.end,a||i)}))}drawingArrow(t,r){this.clearCanvas(),this.drawExistedArrow(),this.drawExistedArea(),this.currentArrow=[t,r],this.drawVerticalArrow(t,r),this.drawArrow(t,r)}saveCurArrow(){return!!this.currentArrow.length&&(this.arrowArr.push({start:this.currentArrow[0],end:this.currentArrow[1],config:{name:"名称",type:"类型"}}),this.currentArrow=[],!0)}drawArrow({x:t,y:r},{x:e,y:i},a){const s=10,n=45;let o,h;const c=180*Math.atan2(r-i,t-e)/Math.PI,l=(c+n)*Math.PI/180,w=(c-n)*Math.PI/180,d=s*Math.cos(l),A=s*Math.sin(l),u=s*Math.cos(w),x=s*Math.sin(w);this.context.beginPath(),this.context.moveTo(t,r),this.context.lineTo(e,i),o=e+d,h=i+A,this.context.moveTo(o,h),this.context.lineTo(e,i),o=e+u,h=i+x,this.context.lineTo(o,h),this.context.strokeStyle=a?this.lineActiveStyle:this.strokeStyle,this.context.lineWidth=this.lineWidth,this.context.stroke()}drawVerticalArrow({x:t,y:r},{x:e,y:i}){const a={x:(t+e)/2,y:(r+i)/2},s=180*Math.atan2(r-i,t-e)/Math.PI,n=(s+90)*Math.PI/180,o=25,h={x:a.x+o*Math.cos(n),y:a.y+o*Math.sin(n)};this.context.setLineDash([2,1]),this.drawArrow(a,h),this.context.setLineDash([]),this.context.closePath()}drawingArea(t){this.clearCanvas(),this.drawExistedArrow(),this.drawExistedArea(),this.drawArea([...this.currentArea,t])}drawArea(t,r,e=!1){const i=t[0];this.context.beginPath(),this.context.moveTo(i.x,i.y),t.slice(1).forEach((t=>{this.context.lineTo(t.x,t.y)})),this.context.lineTo(i.x,i.y),this.context.lineWidth=this.lineWidth,this.context.strokeStyle=this.strokeStyle,this.context.stroke(),this.context.closePath();let a=!1;r&&(this.context.isPointInPath(r.x,r.y)?a=!0:t.forEach((t=>{o(t.x,t.y,this.areaVertexRadius,r.x,r.y)&&(a=!0)}))),this.context.fillStyle=a||e?this.areaActiveStyle:this.fillStyle,this.context.fill(),t.forEach((t=>{this.context.beginPath(),this.context.arc(t.x,t.y,this.areaVertexRadius,0,2*Math.PI),this.context.lineTo(t.x,t.y),this.context.fillStyle=a||e?this.lineActiveStyle:this.strokeStyle,this.context.fill()}))}setDragOriginPoint(t){this.dragOriginPoint=t}clearTempCopyArea(){this.tempCopyArea=[]}setTargetVertex(t){if(-1!==this.activeAreaIndex){const r=this.areaArr[this.activeAreaIndex];r&&r.area.forEach((r=>{o(r.x,r.y,this.areaVertexRadius,t.x,t.y)&&(this.targetVertex=r)}))}}dragingArea(t){if(-1!==this.activeAreaIndex){const r=this.areaArr.splice(this.activeAreaIndex,1);if(this.targetVertex)this.targetVertex.x=t.x,this.targetVertex.y=t.y;else{this.tempCopyArea.length||(this.tempCopyArea=r[0].area.map((t=>({...t}))));const e=t.x-this.dragOriginPoint.x,i=t.y-this.dragOriginPoint.y;r[0].area.forEach(((t,r)=>{const a=this.tempCopyArea[r];t.x=a.x+e,t.y=a.y+i}))}this.areaArr.push(...r),this.activeAreaIndex=this.areaArr.length-1,this.clearCanvas(),this.drawExistedArrow(),this.drawExistedArea(t)}}saveCurArea(){return!!this.currentArea.length&&(this.areaArr.push({area:[...this.currentArea],config:{name:"名称",type:"类型"}}),this.currentArea=[],!0)}drawExistedArea(t){this.areaArr.length&&this.areaArr.forEach(((r,e)=>{this.drawArea(r.area,t,this.activeAreaIndex===e)}))}checkArea(){let t=!0;return this.areaArr.forEach((r=>{console.log("intersects(item.area): ",h(r.area[0],r.area)),console.log("item.area: ",r.area),h(r.area[0],r.area)||(t=!1)})),t}}var w={data(){return{width:300,height:150,GJLDraw:null,clickTimeout:null,timeoutDelay:200,arrowLoc:{from:null,to:null},isDrawingArrow:!1,isDrawingArea:!1,mousePosition:{x:0,y:0},canDrag:!1,isDraging:!1}},computed:{activeArrowIndex(){return this.GJLDraw?this.GJLDraw.activeArrowIndex:-1},activeArrow(){return this.GJLDraw?-1===this.GJLDraw.activeArrowIndex?{start:null,end:null,config:null}:this.GJLDraw.arrowArr[this.GJLDraw.activeArrowIndex]:{start:null,end:null,config:null}},isDrawing(){return this.isDrawingArrow||this.isDrawingArea}},mounted(){this.$nextTick((()=>{const t=this.$refs.canvasRef.getBoundingClientRect();this.width=t.width,this.height=t.height,this.GJLDraw=new l(this.$refs.canvas,{})}))},methods:{windowToCanvas(t,r,e){const i=t.getBoundingClientRect();return{x:r-i.x,y:e-i.y}},handleClick(t){const r=this.windowToCanvas(this.$refs.canvas,t.clientX,t.clientY);this.mousePosition=r,clearTimeout(this.clickTimeout),this.isDrawingArrow?this.clickTimeout=setTimeout((()=>{this.arrowLoc.from=r}),this.timeoutDelay):this.isDrawingArea?this.clickTimeout=setTimeout((()=>{this.GJLDraw.currentArea.push(r)}),this.timeoutDelay):this.clickTimeout=setTimeout((()=>{this.GJLDraw.setActiveArrowIndex(r),this.GJLDraw.setActiveAreaIndex(r),this.GJLDraw.drawExistedArrow(r),this.GJLDraw.drawExistedArea(r)}),this.timeoutDelay)},handleDblclick(t){if((!this.isDrawingArrow||!this.arrowLoc.from)&&!this.isDrawingArea)return;clearTimeout(this.clickTimeout);const r=this.windowToCanvas(this.$refs.canvas,t.clientX,t.clientY);this.isDrawingArrow?(this.arrowLoc.to=r,this.GJLDraw.drawingArrow(this.arrowLoc.from,this.arrowLoc.to),this.GJLDraw.saveCurArrow(),this.arrowLoc.from=this.arrowLoc.to=null,this.isDrawingArrow=!1):this.isDrawingArea&&(this.GJLDraw.currentArea.push(r),this.GJLDraw.saveCurArea(),this.isDrawingArea=!1)},handleMove(t){const r=this.windowToCanvas(this.$refs.canvas,t.clientX,t.clientY);this.isDrawingArrow?(this.arrowLoc.to=r,this.arrowLoc.from&&this.arrowLoc.to&&this.GJLDraw.drawingArrow(this.arrowLoc.from,this.arrowLoc.to)):this.isDrawingArea?this.GJLDraw.drawingArea(r):this.canDrag?this.GJLDraw.dragingArea(r):(this.GJLDraw.clearCanvas(),this.GJLDraw.drawExistedArrow(r),this.GJLDraw.drawExistedArea(r))},handleDown(t){this.canDrag=!0,this.isDraging=!0;const r=this.windowToCanvas(this.$refs.canvas,t.clientX,t.clientY);this.GJLDraw.setDragOriginPoint(r),this.GJLDraw.setActiveAreaIndex(r),this.GJLDraw.setTargetVertex(r)},handleUp(t){this.canDrag=!1,this.isDraging=!1,this.GJLDraw.clearTempCopyArea(),this.GJLDraw.targetVertex=null},handleDrawArrow(){this.isDrawingArrow=!0},handleDrawArea(){this.isDrawingArea=!0},handleReverseArrow(){this.GJLDraw.reverseActiveArrow()},handleDeleteArrow(){this.GJLDraw.deleteActiveArrow()},handleDeleteArea(){this.GJLDraw.deleteActiveArea()},handleClear(){this.GJLDraw.reset()},getRandomNumer(t){return parseInt(Math.random()*t)},handleCheckArea(){this.GJLDraw.checkArea()}}},d=w,A=e(5459),u=(0,A.Z)(d,a,s,!1,null,"2ce8a8b2",null),x=u.exports,v=e(3346),f=e.n(v);i["default"].use(f()),i["default"].config.productionTip=!1,new i["default"]({render:t=>t(x)}).$mount("#app")}},r={};function e(i){var a=r[i];if(void 0!==a)return a.exports;var s=r[i]={exports:{}};return t[i](s,s.exports,e),s.exports}e.m=t,function(){var t=[];e.O=function(r,i,a,s){if(!i){var n=1/0;for(l=0;l<t.length;l++){i=t[l][0],a=t[l][1],s=t[l][2];for(var o=!0,h=0;h<i.length;h++)(!1&s||n>=s)&&Object.keys(e.O).every((function(t){return e.O[t](i[h])}))?i.splice(h--,1):(o=!1,s<n&&(n=s));if(o){t.splice(l--,1);var c=a();void 0!==c&&(r=c)}}return r}s=s||0;for(var l=t.length;l>0&&t[l-1][2]>s;l--)t[l]=t[l-1];t[l]=[i,a,s]}}(),function(){e.n=function(t){var r=t&&t.__esModule?function(){return t["default"]}:function(){return t};return e.d(r,{a:r}),r}}(),function(){e.d=function(t,r){for(var i in r)e.o(r,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:r[i]})}}(),function(){e.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){e.o=function(t,r){return Object.prototype.hasOwnProperty.call(t,r)}}(),function(){e.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){var t={143:0};e.O.j=function(r){return 0===t[r]};var r=function(r,i){var a,s,n=i[0],o=i[1],h=i[2],c=0;if(n.some((function(r){return 0!==t[r]}))){for(a in o)e.o(o,a)&&(e.m[a]=o[a]);if(h)var l=h(e)}for(r&&r(i);c<n.length;c++)s=n[c],e.o(t,s)&&t[s]&&t[s][0](),t[s]=0;return e.O(l)},i=self["webpackChunkvue2_canvas_demo"]=self["webpackChunkvue2_canvas_demo"]||[];i.forEach(r.bind(null,0)),i.push=r.bind(null,i.push.bind(i))}();var i=e.O(void 0,[998],(function(){return e(9532)}));i=e.O(i)})();
//# sourceMappingURL=app.e33e8182.js.map